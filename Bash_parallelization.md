# Bash parallelization

This branch contains scripts that, in a modified form, have been used in the BB 2023 pipeline comparison paper. We have attempted a preliminary parallelization using bash. The scripts inside the folder `bash_parallel`can be divided into two types: frontend (`run_`) files and intermediary (`bbpower_`) files. The former call the latter and can be run on computing nodes (originally tested on the interactive mode on 50 Cori Haswell nodes). The scripts in more detail:

- `run_make_sims.sh` combines 500 polarized, multifrequency map simulations of noise (including 4 splits), CMB and Gaussian foregrounds, respecively and writes them to disk. Then it computes split power spectra of using `BBPowerSpecter`, cross-correlates splits using `BBPowerSummarizer` and saves the resulting fits files. Maps are deleted after this procedure. The intermediary file is `bbpower_sims.sh`.
- `run_get_covariance.sh` reads 4x500 multifrequency power spectra of coadded sky simulations (where the factor 4 comes from the noise splits) and computes the power spectrum covariance matrix using `BBPowerSummarizer`. The covariance is then stored in the file `cells_coadded.fits`, seed '0000' of the corresponding Gaussian simulations. This script can be run on a single node, and there is no intermediary script.
- `run_full_data_pipe.sh` combines 500 polarized, multifrequency mock data maps of noise (including 4 splits), CMB and (not necessarily Gaussian) foregrounds, respecively and writes them to disk. Then it computes split power spectra of using `BBPowerSpecter`, cross-correlates splits using `BBPowerSummarizer` and saves the resulting fits files. Maps are deleted after this procedure. Then, noise-debiased power spectra (saved as `cells_coadded.fits` in the respective output directories) together with the (precomputed) covariance matrix fits file, are fed into the parametric component separation stage `BBCompSep` which outputs posterior files (e.g. MCMC chains using `emcee`) of cosmological and foreground parameters. The intermediary script is `bbpower_data.sh`.
- `run_compsep.sh` runs the component separation stage `BBCompSep` on 500 noise-debiased multifrequency power spectra, given a power spectrum covariance matrix stored in a fits file.
